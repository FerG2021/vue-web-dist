import{_ as z,r as c,d as G,o as u,c as f,a as r,w as t,e as D,f as O,g as m,t as p,i as k,b as d,E as F,v as B,F as x,h as M,p as K,j as Q}from"./index.8bc8b4af.js";const W={data(){return{id:null,loading:!1,loadingProductos:!1,loadingProveedores:!1,datos:null,datosProductos:[],datosProveedores:[]}},methods:{abrir(e){this.loading=!0,this.loadingProductos=!0,this.loadingProveedores=!0,this.id=null,this.id=e,this.datos=null,this.datosProductos=[],this.datosProveedores=[],this.$refs.modal.abrir(),this.getDatos()},cerrar(){this.$refs.modal.cerrar()},async getDatos(){await this.axios.get("/api/borradorpresupuestacion/obtenerDatos/"+this.id).then(e=>{const o=e;console.log(o),o!=null?(this.datos=o.data,console.log(this.datos),this.loading=!1,this.datosProductos=o.data.productos,this.loadingProductos=!1,console.log("this.datosProductos"),console.log(this.datosProductos),this.datosProveedores=o.data.proveedores,this.loadingProveedores=!1):this.cerrar()})},formatearFecha(e){return new Date(e).toLocaleDateString()}}},X={key:0},Z=d("h3",{style:{"margin-top":"15px"}},[d("b",null,"Productos")],-1),$={key:0},oo=d("h3",{style:{"margin-top":"15px"}},[d("b",null,"Proveedores")],-1),ro={key:1};function eo(e,o,a,n,s,h){const b=c("el-descriptions-item"),S=c("el-descriptions"),P=c("el-table-column"),v=c("el-table"),A=c("modal"),g=G("loading");return u(),f("div",null,[r(A,{ref:"modal",titulo:"Detalle del borrador","impedir-close":e.impedirClose,width:"80%"},{default:t(()=>[D((u(),O(S,{title:"Informaci\xF3n del borrador",direction:"vertical",column:3,size:e.size,border:""},{default:t(()=>[s.datos!=null?(u(),f("div",X,[r(b,{label:"Nro. presupuestaci\xF3n"},{default:t(()=>[m(p(s.datos.borrador_presupuestacion_id),1)]),_:1}),r(b,{label:"Fecha de creaci\xF3n"},{default:t(()=>[m(p(h.formatearFecha(s.datos.borrador_presupuesto_fecha_creacion)),1)]),_:1}),r(b,{label:"Plan"},{default:t(()=>[m(p(s.datos.borrador_presupuestacion_plan_nombre),1)]),_:1}),r(b,{label:"Incio de presupuestaci\xF3n"},{default:t(()=>[m(p(h.formatearFecha(s.datos.borrador_presupuestacion_fecha_incio)),1)]),_:1}),r(b,{label:"Fin de presupuestaci\xF3n"},{default:t(()=>[m(p(h.formatearFecha(s.datos.borrador_presupuestacion_fecha_fin)),1)]),_:1})])):k("",!0)]),_:1},8,["size"])),[[g,s.loading]]),Z,s.datosProductos?(u(),f("div",$,[D((u(),O(v,{data:s.datosProductos,stripe:"",style:{width:"100%"}},{default:t(()=>[r(P,{prop:"nombre",label:"Nombre"},{default:t(l=>[d("span",null,p(l.row.productoPresupuestacion.borrador_producto_nombre),1)]),_:1}),r(P,{prop:"nombre",label:"Rubro"},{default:t(l=>[d("span",null,p(l.row.productoPresupuestacion.borrador_producto_rubro_nombre),1)]),_:1}),r(P,{prop:"nombre",label:"Unidad"},{default:t(l=>[d("span",null,p(l.row.producto.producto_unidad),1)]),_:1}),r(P,{prop:"cantidad",label:"Cantidad a comprar"},{default:t(l=>[d("span",null,p(l.row.productoPresupuestacion.borrador_producto_cantidad_a_comprar),1)]),_:1}),r(P,{prop:"cantidad",label:"Observaciones"},{default:t(l=>[d("span",null,p(l.row.productoPresupuestacion.borrador_producto_observaciones),1)]),_:1})]),_:1},8,["data"])),[[g,s.loadingProductos]])])):k("",!0),oo,s.datosProveedores?(u(),f("div",ro,[D((u(),O(v,{data:s.datosProveedores,stripe:"",style:{width:"100%"}},{default:t(()=>[r(P,{prop:"nombre",label:"Nombre"},{default:t(l=>[d("span",null,p(l.row.proveedor.borrador_proveedor_nombre),1)]),_:1}),r(P,{prop:"nombre",label:"Rubro"},{default:t(l=>[d("span",null,p(l.row.rubro.rubro_nombre),1)]),_:1}),r(P,{prop:"nombre",label:"Mail"},{default:t(l=>[d("span",null,p(l.row.proveedor.borrador_proveedor_mail),1)]),_:1})]),_:1},8,["data"])),[[g,s.loadingProductos]])])):k("",!0)]),_:1},8,["impedir-close"])])}var ao=z(W,[["render",eo]]);const to={data(){return{id:null,indice:null,datosDeposito:[],loading:!1,cantidadTotalDeposito:0,datosSacarDeposito:null,arrayCantidadesDeposito:[],yaSumado:0}},methods:{abrir(e,o){this.$refs.modal.abrir(),this.id=e.row.producto_id,this.indice=e.$index,this.datosDeposito=[],this.cantidadTotalDeposito=0,this.datosSacarDeposito=null,this.yaSumado=0,console.log(e),console.log("id: "+e.row.producto_id),console.log("indice: "+e.$index),this.arrayCantidadesDeposito=[],this.arrayCantidadesDeposito=o,console.log("arrayCantidadesDepositoRecibido"),console.log(o),this.getDatos()},cerrar(){this.$refs.modal.cerrar()},async getDatos(){this.loading=!0,await this.axios.get("/api/depositoArticulo/obtenerDatos/"+this.id).then(e=>{this.datosDeposito=e.data,console.log("this.datosDeposito"),console.log(this.datosDeposito),console.log("this.arrayCantidadesDeposito en getDatos"),console.log(this.arrayCantidadesDeposito),this.arrayCantidadesDeposito.forEach(o=>{this.datosDeposito.forEach(a=>{o.deposito_id==a.deposito_id&&o.producto_id==a.producto_id&&o.deposito_producto_id==a.deposito_producto_id&&(a.cantidadAUtilizar=o.cantidad_utilizar)})})}),this.loading=!1},sumardatosSacarDeposito(e,o){this.yaSumado=1,console.log("row"),console.log(o),console.log("this.arrayCantidadesDeposito"),console.log(this.arrayCantidadesDeposito);let a=0;if(this.arrayCantidadesDeposito.length>0)this.arrayCantidadesDeposito.forEach(n=>{console.log("entra PRIMERO"),n.deposito_id==o.deposito_id&&n.producto_id==o.producto_id&&(a=1,n.producto_stock=o.producto_stock,n.cantidad_utilizar=e)});else{a=1,console.log("entra SEGUNDO");let n={deposito_id:o.deposito_id,deposito_producto_id:o.deposito_producto_id,producto_activo:o.producto_activo,producto_id:o.producto_id,producto_nombre:o.producto_nombre,producto_stock:o.producto_stock,producto_unidad:o.producto_unidad,rubro_id:o.rubro_id,cantidad_utilizar:e};this.arrayCantidadesDeposito.push(n)}if(a==0){console.log("entra TERCERO");let n={deposito_id:o.deposito_id,deposito_producto_id:o.deposito_producto_id,producto_activo:o.producto_activo,producto_id:o.producto_id,producto_nombre:o.producto_nombre,producto_stock:o.producto_stock,producto_unidad:o.producto_unidad,rubro_id:o.rubro_id,cantidad_utilizar:e};this.arrayCantidadesDeposito.push(n)}console.log("this.arrayCantidadesDepositoAgregado"),console.log(this.arrayCantidadesDeposito),console.log("this.cantidadTotalDeposito"),console.log(this.cantidadTotalDeposito)},enviarCantidadAUtilizarDeposito(){this.arrayCantidadesDeposito.forEach(e=>{e.producto_id==this.id&&(this.cantidadTotalDeposito=parseFloat(this.cantidadTotalDeposito)+parseFloat(e.cantidad_utilizar))}),this.datosSacarDeposito={indice:this.indice,cantidadUsar:this.cantidadTotalDeposito},this.$emit("update:cantidadSacarDeposito",this.datosSacarDeposito),this.cerrar()}}},so=m(" Agregar ");function io(e,o,a,n,s,h){const b=c("el-table-column"),S=c("el-input-number"),P=c("el-table"),v=c("el-col"),A=c("el-button"),g=c("el-row"),l=c("modal"),E=G("loading");return u(),f("div",null,[r(l,{ref:"modal",titulo:"Buscar producto en dep\xF3sito","impedir-close":e.impedirClose},{default:t(()=>[d("div",null,[D((u(),O(P,{data:s.datosDeposito,stripe:"",style:{width:"100%"}},{default:t(()=>[r(b,{prop:"date",label:"Dep\xF3sito"},{default:t(_=>[d("span",null,[d("b",null,p(_.row.deposito.deposito_nombre),1)])]),_:1}),r(b,{prop:"date",label:"Producto"},{default:t(_=>[d("span",null,p(_.row.producto_nombre),1)]),_:1}),r(b,{prop:"date",label:"Stock"},{default:t(_=>[d("span",null,p(_.row.producto_stock),1)]),_:1}),r(b,{prop:"cantidadAUtilizar",label:"Cant. a utilizar"},{default:t(_=>[r(S,{modelValue:_.row.cantidadAUtilizar,"onUpdate:modelValue":N=>_.row.cantidadAUtilizar=N,max:_.row.producto_stock,controls:!1,align:"center","text-align":"center",style:{width:"100%"},onChange:N=>h.sumardatosSacarDeposito(_.row.cantidadAUtilizar,_.row)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),_:1})]),_:1},8,["data"])),[[E,s.loading]]),r(g,{gutter:10,style:{"margin-top":"15px"}},{default:t(()=>[r(v,{span:3}),r(v,{span:3}),r(v,{span:3}),r(v,{span:3}),r(v,{span:3}),r(v,{span:3}),r(v,{span:2}),r(v,{span:3},{default:t(()=>[r(A,{type:"primary",style:{width:"100%"},onClick:o[0]||(o[0]=_=>h.enviarCantidadAUtilizarDeposito())},{default:t(()=>[so]),_:1})]),_:1}),r(v,{span:1})]),_:1})])]),_:1},8,["impedir-close"])])}var no=z(to,[["render",io]]);const lo={components:{ModalBuscarProductoDeposito:no},data(){return{form:{nombreObra:null,montoObra:null,fechaObra:null,producto:null,fDesde:null,fHasta:null,cantMeses:null,fDesdePresupuestada:null,fHastaPresupuestada:null,fechaaPresupuestar:[],mesesaPresupuestar:null,rubroaPresupuestar:null},cargando:!1,loadingDesdeSelectPlan:!1,rubrosSelect:[],active:0,planesSelect:[],datosPlanSeleccionado:[],arrayMeses:[],mostrarFechaIncioPresupuestacion:null,mostrarFechaFinPresupuestacion:null,mostrarCantidadMesesPresupuestacion:null,mostrarRubroPresupuestacion:null,filtroRubro:"",productos:[],productosNuevo:[],arrAuxProductosDesdePrevision:[],productosDesdePrevision:[],productosDesdePrevisionNuevo:[],arrayBuscarProductosEnPrevision:[],productoSeleccionado:null,rubroProductoSeleccionado:null,unidadProductoSeleccionado:null,cantidadAComprarProductoSeleccionado:null,arrayProductosAComprar:[],arrayProductosAComprarEnviar:[],arrayRubrosAComprar:[],b:0,arrayRubrosAComprarEnviar:[],arrayDatosParaCantidadPresupestacion:[],loadingCantidadAComprar:!1,arrayCantidadesDeposito:[],loadingProveedoresParaMail:!1,arrayProveedoresRecibidos:[],arrayProveedoresMostrar:[],arrayProveedoresMostrarEnviar:[],fechaLimiteCarga:null,checked2:null,id:null,datosGenerales:[],productosYaPresupuestados:[],proveedoresYaPresupuestados:[],loadingOnSubmitBorrador:!1,loadingOnSubmit:!1}},created(){this.obtenerPlanesSelect(),this.obtenerRubrosSelect(),this.obtenerProductosSelect()},watch:{filtroRubro(e){e==""?(this.productosDesdePrevisionNuevo=[],this.productosDesdePrevision.forEach(o=>{let a=0;this.productosDesdePrevisionNuevo.forEach(n=>{n.producto_id==o.producto_id&&(a=1)}),a==0&&this.productosDesdePrevisionNuevo.push(o)})):(this.productosDesdePrevisionNuevo=this.buscarRubro(e),console.log("*****productosDesdePrevisionNuevo"),console.log(this.productosDesdePrevisionNuevo))}},methods:{abrir(e){this.id=e,this.form.nombreObra=null,this.form.montoObra=null,this.form.fechaObra=null,this.form.producto=null,this.form.fDesde=null,this.form.fHasta=null,this.form.cantMeses=null,this.form.fDesdePresupuestada=null,this.form.fHastaPresupuestada=null,this.form.fechaaPresupuestar=[],this.form.mesesaPresupuestar=null,this.form.rubroaPresupuestar=null,this.cargando=!1,this.loadingDesdeSelectPlan=!1,this.active=0,this.planesSelect=[],this.datosPlanSeleccionado=[],this.arrayMeses=[],this.mostrarFechaIncioPresupuestacion=null,this.mostrarFechaFinPresupuestacion=null,this.mostrarCantidadMesesPresupuestacion=null,this.mostrarRubroPresupuestacion=null,this.filtroRubro="",this.arrAuxProductosDesdePrevision=[],this.productosDesdePrevision=[],this.arrayBuscarProductosEnPrevision=[],this.productoSeleccionado=null,this.rubroProductoSeleccionado=null,this.unidadProductoSeleccionado=null,this.cantidadAComprarProductoSeleccionado=null,this.arrayProductosAComprar=[],this.arrayProductosAComprarEnviar=[],this.arrayRubrosAComprar=[],this.b=0,this.arrayRubrosAComprarEnviar=[],this.arrayDatosParaCantidadPresupestacion=[],this.arrayCantidadesDeposito=[],this.arrayProveedoresRecibidos=[],this.arrayProveedoresMostrar=[],this.arrayProveedoresMostrarEnviar=[],this.checked2=null,this.datosGenerales=[],this.productosYaPresupuestados=[],this.proveedoresYaPresupuestados=[],this.fechaLimiteCarga=null,this.loadingOnSubmitBorrador=!1,this.loadingOnSubmit=!1,this.$refs.modal.abrir(),this.getDatos(),this.obtenerPlanesSelect()},cerrar(){this.$refs.modal.cerrar()},async getDatos(){await this.axios.get("/api/borradorpresupuestacion/obtenerDatos/"+this.id).then(e=>{const o=e;console.log("respuestaApi"),console.log(o.data),o!=null?(this.datosGenerales=o.data,this.datosGenerales.transferencias.forEach(a=>{console.log("elemento trans");let n={deposito_id:a.itemTransferencia.transferencia_deposito_id,deposito_producto_id:a.itemTransferencia.transferencia_deposito_producto_id,producto_activo:a.itemTransferencia.transferencia_producto_activo,producto_id:a.itemTransferencia.transferencia_producto_id,producto_nombre:a.itemTransferencia.transferencia_producto_nombre,producto_stock:a.itemTransferencia.transferencia_producto_stock,producto_unidad:a.itemTransferencia.transferencia_producto_unidad,rubro_id:a.itemTransferencia.transferencia_producto_rubro_id,cantidad_utilizar:a.itemTransferencia.transferencia_cantidad_utilizar};this.arrayCantidadesDeposito.push(n)}),console.log("this.arrayCantidadesDeposito"),console.log(this.arrayCantidadesDeposito),this.fechaLimiteCarga=this.datosGenerales.borrador_presupuesto_fecha_limite,console.log("this.datosGenerales"),console.log(this.datosGenerales),this.form.fechaaPresupuestar[0]=this.datosGenerales.borrador_presupuestacion_fecha_incio,this.form.fechaaPresupuestar[1]=this.datosGenerales.borrador_presupuestacion_fecha_fin,this.form.nombreObra=this.datosGenerales.borrador_presupuestacion_plan_id,this.form.fDesde=this.datosGenerales.borrador_presupuestacion_plan_fecha_inicio,this.form.fHasta=this.datosGenerales.borrador_presupuestacion_plan_fecha_fin,this.form.cantMeses=this.datosGenerales.borrador_presupuestacion_plan_plazo,this.form.fDesdePresupuestada=this.datosGenerales.borrador_presupuestacion_fecha_incio,this.form.fHastaPresupuestada=this.datosGenerales.borrador_presupuestacion_fecha_fin,this.datosGenerales.productos.forEach(a=>{let n={borrador_presupuestacion_producto_id:a.productoPresupuestacion.borrador_presupuestacion_producto_id,producto_id:a.productoPresupuestacion.borrador_producto_id,producto_codigo:a.producto.producto_codigo,producto_nombre:a.productoPresupuestacion.borrador_producto_nombre,producto_puc:a.producto.producto_puc,producto_fpuc:a.producto.producto_fpuc,producto_unidad:a.producto.producto_unidad,producto_activo:a.producto.producto_activo,rubro_id:a.producto.rubro_id,rubro_nombre:a.productoPresupuestacion.borrador_producto_rubro_nombre,cantidadAComprar:a.productoPresupuestacion.borrador_producto_cantidad_a_comprar,cantidadDeposito:a.productoPresupuestacion.borrador_producto_cantidad_deposito,cantidadRealAComprar:a.productoPresupuestacion.borrador_producto_cantidad_real_a_comprar,observaciones:a.productoPresupuestacion.borrador_producto_observaciones,accion:"B"};this.productosYaPresupuestados.push(n)}),console.log("this.productosYaPresupuestados"),console.log(this.productosYaPresupuestados),this.productosYaPresupuestados.forEach(a=>{let n={producto_id:a.producto_id,producto_codigo:a.producto_codigo,producto_nombre:a.producto_nombre,producto_puc:a.producto_puc,producto_fpuc:a.producto_fpuc,producto_unidad:a.producto_unidad,producto_activo:a.producto_activo,rubro_id:a.rubro_id,rubro_nombre:a.rubro_nombre,cantidadAComprar:a.cantidadAComprar,cantidadDeposito:a.cantidadDeposito,cantidadRealAComprar:a.cantidadRealAComprar,observaciones:a.observaciones,accion:"A"};this.arrayProductosAComprar.push(n)}),this.datosGenerales.proveedores.forEach(a=>{let n={presupuestacion_proveedor_id:a.proveedor.borrador_presupuestacion_proveedor_id,presupuestacion_id:a.proveedor.borrador_presupuestacion_id,presupuestacion_plan_id:a.proveedor.borrador_presupuestacion_plan_id,proveedor_id:a.proveedor.borrador_proveedor_id,proveedor_nombre:a.proveedor.borrador_proveedor_nombre,proveedor_rubro_id:a.proveedor.borrador_proveedor_rubro_id,proveedor_mail:a.proveedor.borrador_proveedor_mail,accion:"B"};this.proveedoresYaPresupuestados.push(n)}),console.log("this.proveedoresYaPresupuestados"),console.log(this.proveedoresYaPresupuestados),this.loadingProveedores=!1,this.tomarValorPlan(this.datosGenerales.borrador_presupuestacion_plan_id)):this.cerrar()}),this.cantidadMeses()},activar1YRecargar(){this.active=1,console.log("recargar")},buscarRubro(e){return this.productosDesdePrevision.forEach(o=>{let a=0;o.rubro.rubro_id==e&&(this.productosDesdePrevisionNuevo.forEach(n=>{n.producto_id==o.producto_id&&(a=1)}),a==0&&this.productosDesdePrevisionNuevo.push(o))}),this.productosDesdePrevisionNuevo},async obtenerPlanesSelect(){this.cargando=!0,await this.axios.get("/api/plan/obtenerTodosSelect").then(e=>{this.planesSelect=e.data,console.log(this.planesSelect)}),this.cargando=!1},async obtenerRubrosSelect(){await this.axios.get("/api/rubro/obtenerTodosSelect").then(e=>{this.rubrosSelect=e.data})},async obtenerProductosSelect(){await this.axios.get("/api/producto/obtenerTodos").then(e=>{this.productos=this.productosNuevo=e.data.datos})},async tomarValorPlan(e){this.loadingDesdeSelectPlan=!0,await this.axios.get("/api/plan/obtenerDatos/"+e).then(o=>{this.datosPlanSeleccionado=o.data,this.form.fDesde=this.datosPlanSeleccionado.plan_fdesde,this.form.fHasta=this.datosPlanSeleccionado.plan_fhasta,this.form.cantMeses=this.datosPlanSeleccionado.plan_plazo;let a=new Date(2021,8,28);for(let n=0;n<this.form.cantMeses;n++){let s={nombre:a};this.arrayMeses.push(s),a=new Date(a.setMonth(a.getMonth()+1))}console.log(this.datosPlanSeleccionado)}),this.loadingDesdeSelectPlan=!1},tomarValor(e){this.planesSelect.forEach(o=>{o.id==e&&(console.log(o),this.idProducto=o.id,this.nombreProducto=o.descripcion,this.unidadMedidaProducto=o.unidadMedida.nombre,this.categoriaProducto=o.categoria.nombre)})},deshabilitarSelectFechaaPresupuestar(){return this.form.nombreObra==null},seleccionarRubroPresupuestar(){this.filtroRubro!=""?this.rubrosSelect.forEach(o=>{o.rubro_id==this.filtroRubro&&(this.mostrarRubroPresupuestacion=o.rubro_nombre)}):this.mostrarRubroPresupuestacion=null,console.log("this.productosDesdePrevisionNuevo en seleccionarRubroPresupuestar"),console.log(this.productosDesdePrevisionNuevo),console.log("this.productosDesdePrevision en seleccionarRubroPresupuestar"),console.log(this.productosDesdePrevision);let e=!1;if(e=this.arrayRubrosAComprar.filter(o=>o.rubro_id==this.filtroRubro),console.log("yaExisteElemento"),console.log(e),e.length==0){let o=0;this.productosDesdePrevision.forEach(a=>{let n=0;if(a.rubro.rubro_id==this.filtroRubro&&(o=1,this.arrayProductosAComprar.forEach(s=>{s.producto_id==a.producto_id&&(s.cantidadAComprar=s.cantidadAComprar+a.prevision_cantidad,n=1)}),console.log("elementoooooooooo"),console.log(a),n==0)){let s={producto_id:a.producto_id,producto_codigo:a.producto_codigo,producto_nombre:a.producto_nombre,producto_puc:a.producto_puc,producto_fpuc:a.producto_fpuc,producto_unidad:a.producto_unidad,producto_activo:a.producto.producto_activo,rubro_id:a.rubro.rubro_id,rubro_nombre:a.rubro.rubro_nombre,cantidadAComprar:a.prevision_cantidad,cantidadDeposito:null,cantidadRealAComprar:null,accion:"A"};this.arrayProductosAComprar.push(s),console.log("this.arrayProductosAComprar"),console.log(this.arrayProductosAComprar);let h={rubro_id:s.rubro_id,rubro_nombre:s.rubro_nombre};this.b=0;let b=!1;b=this.arrayRubrosAComprar.filter(S=>S.rubro_id==h.rubro_id),console.log("yaExisteElemento"),console.log(b),b.length==0&&this.arrayRubrosAComprar.push(h)}}),o==0&&F({message:"\xA1No hay productos para el rubro seleccionado en el periodo eledigo!",type:"error"})}else F({message:"\xA1El rubro seleccionado ya fue agregado a la presupuestaci\xF3n!",type:"error"})},deshabilitarBtnSiguientePaso1(){return this.form.fechaaPresupuestar.length==0},async cantidadMeses(){let e=new Date(this.form.fechaaPresupuestar[0]);console.log("fechaaPresupuestar0"),console.log(e.getMonth());let o=new Date(this.form.fechaaPresupuestar[1]);console.log("fechaaPresupuestar1"),console.log(o.getMonth());let a=o.getMonth()-e.getMonth()+12*(o.getFullYear()-e.getFullYear())+1;this.form.mesesaPresupuestar=a;let n=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),s=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear();this.mostrarFechaIncioPresupuestacion=n,this.mostrarFechaFinPresupuestacion=s,this.mostrarCantidadMesesPresupuestacion=a,this.arrayBuscarProductosEnPrevision=[];let h={plan_id:this.form.nombreObra,fechaDesdePresupuestacion:this.form.fechaaPresupuestar[0],fechaHastaPresupuestacion:this.form.fechaaPresupuestar[1]};this.arrayBuscarProductosEnPrevision.push(h),console.log("this.arrayBuscarProductosEnPrevision"),console.log(this.arrayBuscarProductosEnPrevision);let b={arrayBuscarProductosEnPrevision:JSON.stringify(this.arrayBuscarProductosEnPrevision)};console.log("params"),console.log(b),this.productosDesdePrevision=[],this.productosDesdePrevisionNuevo=[],console.log("this.productosDesdePrevision"),console.log(this.productosDesdePrevision),await this.axios.post("/api/vistaprevision/obtenerDatos",b).then(S=>{this.productosDesdePrevision=this.productosDesdePrevisionNuevo=S.data,console.log("this.productosDesdePrevision"),console.log(this.productosDesdePrevision)})},limpiarFilaProductoSeleccionado(){this.productosDesdePrevisionNuevo=[],this.productoSeleccionado=null,this.rubroProductoSeleccionado=null,this.unidadProductoSeleccionado=null,this.cantidadAComprarProductoSeleccionado=null,this.seleccionarRubroPresupuestar()},deshabilitarSelectRubroaPresupuestar(){return this.form.fechaaPresupuestar.length==0},seleccionarRubroProductoSeleccionado(){this.arrayDatosParaCantidadPresupestacion=[],this.productosNuevo.forEach(e=>{if(e.producto_id==this.productoSeleccionado){console.log("datos del producto seleccionado"),console.log(e),this.rubroProductoSeleccionado=e.rubro.rubro_nombre,this.unidadProductoSeleccionado=e.producto_unidad;let o={fechaDesdePresupuestacion:this.form.fechaaPresupuestar[0],fechaHastaPresupuestacion:this.form.fechaaPresupuestar[1],plan_id:this.form.nombreObra,rubro_id:e.rubro_id,producto_id:e.producto_id,producto_nombre:e.producto_nombre};console.log("fila"),console.log(o),this.arrayDatosParaCantidadPresupestacion.push(o),this.buscarCantidadPrevision(o.producto_id)}})},async buscarCantidadPrevision(e){this.loadingCantidadAComprar=!0,this.productosDesdePrevisionNuevo.forEach(o=>{o.producto_id==e&&(this.cantidadAComprarProductoSeleccionado=o.prevision_cantidad)}),this.loadingCantidadAComprar=!1},agregarProductoAComprar(){if(this.rubroProductoSeleccionado==null||this.rubroProductoSeleccionado==""||this.unidadProductoSeleccionado==null||this.unidadProductoSeleccionado==""||this.cantidadAComprarProductoSeleccionado==null||this.cantidadAComprarProductoSeleccionado==""||this.cantidadAComprarProductoSeleccionado==0)F({message:"\xA1Se deben completar todos los campos!",type:"error"});else{let e=0;this.arrayProductosAComprar.forEach(o=>{o.producto_id==this.productoSeleccionado&&(e=1)}),e==1?(F({message:"\xA1El producto seleccionado ya ha sido agregado!",type:"error"}),this.productoSeleccionado=null,this.rubroProductoSeleccionado=null,this.unidadProductoSeleccionado=null,this.cantidadAComprarProductoSeleccionado=null):this.productosNuevo.forEach(o=>{if(o.producto_id==this.productoSeleccionado){let a={producto_auto:o.producto_auto,producto_id:o.producto_id,producto_codigo:o.producto_codigo,producto_nombre:o.producto_nombre,producto_puc:o.producto_puc,producto_fpuc:o.producto_fpuc,producto_unidad:o.producto_unidad,producto_activo:o.producto_activo,rubro_id:o.rubro_id,rubro_nombre:o.rubro.rubro_nombre,cantidadAComprar:this.cantidadAComprarProductoSeleccionado,cantidadDeposito:null,cantidadRealAComprar:null};this.arrayProductosAComprar.push(a);let n={rubro_id:a.rubro_id,rubro_nombre:a.rubro_nombre};this.b=0;let s=!1;s=this.arrayRubrosAComprar.filter(h=>h.rubro_id==n.rubro_id),console.log("yaExisteElemento"),console.log(s),s.length==0&&this.arrayRubrosAComprar.push(n),this.productoSeleccionado=null,this.rubroProductoSeleccionado=null,this.unidadProductoSeleccionado=null,this.cantidadAComprarProductoSeleccionado=null}})}},eliminarItemArrayProductosAComprar(e){this.arrayProductosAComprar.splice(e.$index,1),this.verificarRubroProductoSigueExistente(e)},verificarRubroProductoSigueExistente(e){console.log("scope"),console.log(e);let o=0;this.arrayRubrosAComprar.forEach(a=>{let n=0;this.arrayProductosAComprar.forEach(s=>{a.rubro_id==s.rubro_id&&(n=1)}),n==0&&this.arrayRubrosAComprar.splice(o,1),o++})},cantidadSacadaDeposito(e){console.log("elemento desde modal"),console.log(e),this.arrayProductosAComprar[e.indice].cantidadAComprar<e.cantidadUsar?F({message:"\xA1Cantidad extra\xEDda de los depositos mayor que la cantidad a presupuestar, por favor seleccione otra cantidad!",type:"error"}):(this.arrayProductosAComprar[e.indice].cantidadDeposito=e.cantidadUsar,this.arrayProductosAComprar[e.indice].cantidadRealAComprar=this.arrayProductosAComprar[e.indice].cantidadAComprar-e.cantidadUsar)},activar2yTraerProveedoresxRubro(){let e=0;this.arrayProductosAComprar.forEach(o=>{o.cantidadDeposito==null&&(e=1)}),e==1?F({message:"\xA1Se deben completar la cantidad real y de dep\xF3sito de cada uno de los productos agregados!",type:"error"}):(this.arrayProductosAComprar.forEach(o=>{let a={rubro_id:o.rubro_id,rubro_nombre:o.rubro_nombre};this.b=0;let n=!1;n=this.arrayRubrosAComprar.filter(s=>s.rubro_id==a.rubro_id),console.log("yaExisteElemento"),console.log(n),n.length==0&&this.arrayRubrosAComprar.push(a)}),this.active=2,this.obtenerProveedorxRubro())},async obtenerProveedorxRubro(){this.arrayProveedoresMostrar=[],console.log("array prov al inicio"),console.log(this.arrayProveedoresMostrar),this.loadingProveedoresParaMail=!0,this.arrayRubrosAComprarEnviar=[],this.arrayRubrosAComprar.forEach(o=>{let a={rubro_id:o.rubro_id,rubro_nombre:o.rubro_nombre,rubro_elegido:null};this.arrayRubrosAComprarEnviar.push(a)}),console.log("this.arrayRubrosAComprarEnviar"),console.log(this.arrayRubrosAComprarEnviar);let e={arrRubrosAComprar:JSON.stringify(this.arrayRubrosAComprarEnviar)};await this.axios.post("/api/proveedorxrubro/obtenerProveedorxRubro",e).then(o=>{console.log(o.data),this.arrayProveedoresRecibidos=o.data}),this.arrayRubrosAComprarEnviar.forEach(o=>{this.arrayProveedoresRecibidos.forEach(a=>{if(o.rubro_id==a.rubro_id){let n={rubro:{rubro_id:o.rubro_id,rubro_nombre:o.rubro_nombre},proveedor:a.proveedor,proveedor_elegido:null};this.arrayProveedoresMostrar.push(n)}})}),console.log("this.arrayProveedoresMostrar"),console.log(this.arrayProveedoresMostrar),this.loadingProveedoresParaMail=!1},cambiarSeleccionSubItemsRubroElegido(e){console.log(e),this.arrayProveedoresMostrar.forEach(o=>{o.rubro.rubro_id==e.rubro_id&&(e.rubro_elegido==!0?o.proveedor_elegido=!0:o.proveedor_elegido=!1)})},async onSubmit(){this.loadingOnSubmit=!0;let e={presupuestacion_id:this.id,presupuestacion_plan_id:this.form.nombreObra,presupuestacion_plan_nombre:this.datosPlanSeleccionado.plan_nombre,presupuestacion_fecha_incio:this.form.fechaaPresupuestar[0],presupuestacion_fecha_fin:this.form.fechaaPresupuestar[1],presupuestacion_fecha_limite:this.fechaLimiteCarga};this.arrayProductosAComprar.forEach(o=>{let a={presupuestacion_producto_id:0,presupuestacion_id:this.id,presupuestacion_plan_id:this.form.nombreObra,producto_id:o.producto_id,producto_nombre:o.producto_nombre,producto_rubro_id:o.rubro_id,producto_rubro_nombre:o.rubro_nombre,producto_unidad_medida:o.producto_unidad,producto_cantidad_a_comprar:o.cantidadAComprar,producto_cantidad_deposito:o.cantidadDeposito,producto_cantidad_real_a_comprar:o.cantidadRealAComprar,producto_observaciones:o.observaciones,accion:"A"};this.arrayProductosAComprarEnviar.push(a)}),e.arrayProductosAComprarEnviar=JSON.stringify(this.arrayProductosAComprarEnviar),this.arrayProveedoresMostrar.forEach(o=>{if(o.proveedor_elegido==!0){let a={presupuestacion_proveedor_id:0,presupuestacion_id:this.id,presupuestacion_plan_id:this.form.nombreObra,proveedor_id:o.proveedor.proveedor_id,proveedor_nombre:o.proveedor.proveedor_nombre,proveedor_rubro_id:o.rubro.rubro_id,proveedor_mail:o.proveedor.proveedor_email,accion:"A"};this.arrayProveedoresMostrarEnviar.push(a)}}),this.productosYaPresupuestados.forEach(o=>{this.arrayProveedoresMostrarEnviar.push(o)}),e.arrayProveedoresMostrarEnviar=JSON.stringify(this.arrayProveedoresMostrarEnviar),e.arrayRubrosAComprar=JSON.stringify(this.arrayRubrosAComprarEnviar),this.arrayCantidadesDeposito.length>0&&(e.arrTransferencias=JSON.stringify(this.arrayCantidadesDeposito)),await this.axios.post("/api/borradorpresupuestacion/crearPresupuestacion",e).then(o=>{console.log(o),o.data&&(F({type:"success",message:"\xA1Prespuestaci\xF3n realizada con \xE9xito!"}),this.$emit("actualizarTabla"),this.cerrar())})},async onSubmitBorrador(){this.loadingOnSubmitBorrador=!0;let e={presupuestacion_id:this.id,presupuestacion_plan_id:this.form.nombreObra,presupuestacion_plan_nombre:this.datosPlanSeleccionado.plan_nombre,presupuestacion_fecha_incio:this.form.fechaaPresupuestar[0],presupuestacion_fecha_fin:this.form.fechaaPresupuestar[1],presupuestacion_fecha_limite:this.fechaLimiteCarga};this.arrayProductosAComprar.forEach(o=>{let a={presupuestacion_producto_id:0,presupuestacion_id:this.id,presupuestacion_plan_id:this.form.nombreObra,producto_id:o.producto_id,producto_nombre:o.producto_nombre,producto_rubro_id:o.rubro_id,producto_rubro_nombre:o.rubro_nombre,producto_cantidad_a_comprar:o.cantidadAComprar,producto_cantidad_deposito:o.cantidadDeposito,producto_cantidad_real_a_comprar:o.cantidadRealAComprar,producto_observaciones:o.observaciones,accion:"A"};this.arrayProductosAComprarEnviar.push(a)}),this.productosYaPresupuestados.forEach(o=>{this.arrayProductosAComprarEnviar.push(o)}),e.arrayProductosAComprarEnviar=JSON.stringify(this.arrayProductosAComprarEnviar),this.arrayProveedoresMostrar.forEach(o=>{if(o.proveedor_elegido==!0){let a={presupuestacion_proveedor_id:0,presupuestacion_id:this.id,presupuestacion_plan_id:this.form.nombreObra,proveedor_id:o.proveedor.proveedor_id,proveedor_nombre:o.proveedor.proveedor_nombre,proveedor_rubro_id:o.rubro.rubro_id,proveedor_mail:o.proveedor.proveedor_email,accion:"A"};this.arrayProveedoresMostrarEnviar.push(a)}}),this.productosYaPresupuestados.forEach(o=>{this.arrayProveedoresMostrarEnviar.push(o)}),e.arrayProveedoresMostrarEnviar=JSON.stringify(this.arrayProveedoresMostrarEnviar),e.arrayRubrosAComprar=JSON.stringify(this.arrayRubrosAComprarEnviar),this.arrayCantidadesDeposito.length>0&&(e.arrTransferencias=JSON.stringify(this.arrayCantidadesDeposito)),await this.axios.post("/api/borradorpresupuestacion/actualizar",e).then(o=>{console.log(o),o.data&&(F({type:"success",message:"\xA1Borrador actualizado con \xE9xito!"}),this.$emit("actualizarTabla"),this.cerrar())})}}},C=e=>(K("data-v-cc19706e"),e=e(),Q(),e),uo={style:{padding:"30px"}},co={class:"contenedorBtnSiguienteAtras"},po=m(" Siguiente "),_o={style:{padding:"30px"}},ho=C(()=>d("span",null,"Inicio presupuestaci\xF3n",-1)),bo=C(()=>d("span",null,"Fin presupuestaci\xF3n",-1)),fo=C(()=>d("span",null,"Cantidad de meses",-1)),mo=C(()=>d("span",null,"Rubro",-1)),go=C(()=>d("span",null,"Producto",-1)),vo=C(()=>d("span",null,"Rubro",-1)),Po=C(()=>d("span",null,"Unidad",-1)),yo=C(()=>d("span",null,"Cantidad a comprar",-1)),Co=C(()=>d("span",{style:{color:"white"}},"btn",-1)),Do=m(" + "),So=C(()=>d("span",{class:"material-icons"},"search",-1)),Ao=C(()=>d("span",{class:"material-icons"},"delete",-1)),Eo={class:"contenedorBtnSiguienteAtras"},Ro=m(" Atr\xE1s "),wo=m(" Siguiente "),xo={style:{padding:"30px"}},Vo={key:0,style:{"margin-bottom":"5px"}},Mo={class:"contenedorBtnSiguienteAtras"},ko=m(" Atr\xE1s "),Fo=m(" Siguiente "),Oo={style:{padding:"30px"}},No=C(()=>d("h1",{style:{"text-align":"center",margin:"0px"}},[d("u",null,[d("b",null,"Resumen de presupuestaci\xF3n")])],-1)),Uo={class:"block"},To=C(()=>d("span",{style:{"margin-right":"10px"},class:"demonstration"},"Fecha l\xEDmite de carga proveedor",-1)),Bo=C(()=>d("h3",null,[d("b",null,"Productos")],-1)),zo={style:{"margin-top":"10px"}},Go={key:0,style:{"margin-bottom":"5px"}},Yo=C(()=>d("h3",null,[d("b",null,"Proveedores")],-1)),Io={style:{"margin-top":"10px"}},Ho={key:0,style:{"margin-bottom":"5px"}},Jo={key:0},Lo={class:"contenedorBtnSiguienteAtras"},jo=m(" Atr\xE1s "),qo=m(" Guardar como borrador "),Ko=m(" Generar presupuestaci\xF3n ");function Qo(e,o,a,n,s,h){const b=c("el-step"),S=c("el-steps"),P=c("el-option"),v=c("el-select"),A=c("el-form-item"),g=c("el-input"),l=c("el-col"),E=c("el-row"),_=c("el-date-picker"),N=c("el-form"),R=c("el-button"),Y=c("el-input-number"),V=c("el-table-column"),H=c("el-table"),I=c("el-checkbox"),J=c("el-button-group"),L=c("modal"),j=c("modal-buscar-producto-deposito"),U=G("loading");return u(),f(x,null,[d("div",null,[r(L,{ref:"modal",titulo:"Borrador presupuestaci\xF3n","impedir-close":e.impedirClose,width:"95%"},{default:t(()=>[r(S,{active:s.active,"finish-status":"success",simple:"",style:{"margin-top":"5px","margin-bottom":"5px"}},{default:t(()=>[r(b,{title:"Obra"}),r(b,{title:"Materiales"}),r(b,{title:"Proveedores"}),r(b,{title:"Resumen"})]),_:1},8,["active"]),D(d("div",uo,[r(N,{"label-width":"120px"},{default:t(()=>[r(A,{label:"Nombre obra",prop:"nombreObra"},{default:t(()=>[r(v,{modelValue:s.form.nombreObra,"onUpdate:modelValue":o[0]||(o[0]=i=>s.form.nombreObra=i),placeholder:"Seleccione un plan",style:{width:"100%"},onChange:o[1]||(o[1]=i=>h.tomarValorPlan(s.form.nombreObra)),disabled:""},{default:t(()=>[(u(!0),f(x,null,M(s.planesSelect,i=>(u(),O(P,{key:i.plan_id,label:i.plan_nombre,value:i.plan_id,disabled:i.disabled,style:{width:"100%"}},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(A,{label:"Fecha de obra",style:{width:"100%"}},{default:t(()=>[r(E,{gutter:10,style:{width:"100%"}},{default:t(()=>[r(l,{span:12,style:{width:"100%"}},{default:t(()=>[D(r(g,{style:{width:"100%"},modelValue:s.form.fDesde,"onUpdate:modelValue":o[2]||(o[2]=i=>s.form.fDesde=i),disabled:"",placeholder:"Fecha de inicio"},null,8,["modelValue"]),[[U,s.loadingDesdeSelectPlan]])]),_:1}),r(l,{span:12,style:{width:"100%"}},{default:t(()=>[D(r(g,{style:{width:"100%"},modelValue:s.form.fHasta,"onUpdate:modelValue":o[3]||(o[3]=i=>s.form.fHasta=i),disabled:"",placeholder:"Fecha de fin"},null,8,["modelValue"]),[[U,s.loadingDesdeSelectPlan]])]),_:1})]),_:1})]),_:1}),r(A,{label:"Meses totales"},{default:t(()=>[D(r(g,{style:{width:"100%"},modelValue:s.form.cantMeses,"onUpdate:modelValue":o[4]||(o[4]=i=>s.form.cantMeses=i),disabled:"",placeholder:"Cantidad de meses"},null,8,["modelValue"]),[[U,s.loadingDesdeSelectPlan]])]),_:1}),r(A,{label:"Fecha a presup."},{default:t(()=>[r(_,{modelValue:s.form.fechaaPresupuestar,"onUpdate:modelValue":o[5]||(o[5]=i=>s.form.fechaaPresupuestar=i),type:"monthrange","range-separator":"a","start-placeholder":"Mes de inicio","end-placeholder":"Mes de fin",style:{width:"100%"},onChange:o[6]||(o[6]=i=>h.cantidadMeses()),disabled:h.deshabilitarSelectFechaaPresupuestar()},null,8,["modelValue","disabled"])]),_:1}),r(A,{label:"Meses a presup."},{default:t(()=>[r(g,{style:{width:"100%"},modelValue:s.form.mesesaPresupuestar,"onUpdate:modelValue":o[7]||(o[7]=i=>s.form.mesesaPresupuestar=i),disabled:"",placeholder:"Cantidad de meses"},null,8,["modelValue"])]),_:1}),r(A,{label:"Rubro a presup."},{default:t(()=>[r(v,{modelValue:s.filtroRubro,"onUpdate:modelValue":o[8]||(o[8]=i=>s.filtroRubro=i),placeholder:"Seleccionar por rubro",filterable:"",clearable:"",style:{width:"100%"},onChange:o[9]||(o[9]=i=>h.limpiarFilaProductoSeleccionado())},{default:t(()=>[(u(!0),f(x,null,M(s.rubrosSelect,i=>(u(),O(P,{key:i.rubro_id,label:i.rubro_nombre,value:i.rubro_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),d("div",co,[r(R,{type:"primary",class:"btnSiguiente",onClick:o[10]||(o[10]=i=>h.activar1YRecargar())},{default:t(()=>[po]),_:1})])],512),[[B,s.active==0]]),D(d("div",_o,[r(E,{gutter:10},{default:t(()=>[r(l,{span:6},{default:t(()=>[ho,r(g,{modelValue:s.mostrarFechaIncioPresupuestacion,"onUpdate:modelValue":o[11]||(o[11]=i=>s.mostrarFechaIncioPresupuestacion=i),disabled:""},null,8,["modelValue"])]),_:1}),r(l,{span:6},{default:t(()=>[bo,r(g,{modelValue:s.mostrarFechaFinPresupuestacion,"onUpdate:modelValue":o[12]||(o[12]=i=>s.mostrarFechaFinPresupuestacion=i),disabled:""},null,8,["modelValue"])]),_:1}),r(l,{span:6},{default:t(()=>[fo,r(g,{modelValue:s.mostrarCantidadMesesPresupuestacion,"onUpdate:modelValue":o[13]||(o[13]=i=>s.mostrarCantidadMesesPresupuestacion=i),disabled:""},null,8,["modelValue"])]),_:1}),r(l,{span:6},{default:t(()=>[mo,r(g,{modelValue:s.mostrarRubroPresupuestacion,"onUpdate:modelValue":o[14]||(o[14]=i=>s.mostrarRubroPresupuestacion=i),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),r(E,{gutter:10,style:{"margin-top":"15px"}},{default:t(()=>[r(l,{span:10},{default:t(()=>[go,r(v,{modelValue:s.productoSeleccionado,"onUpdate:modelValue":o[15]||(o[15]=i=>s.productoSeleccionado=i),placeholder:"Seleccionar producto",filterable:"",clearable:"",style:{width:"100%"},onChange:o[16]||(o[16]=i=>h.seleccionarRubroProductoSeleccionado())},{default:t(()=>[(u(!0),f(x,null,M(s.productosDesdePrevisionNuevo,i=>(u(),O(P,{key:i.producto_id,label:i.producto_nombre,value:i.producto_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(l,{span:6},{default:t(()=>[vo,r(g,{modelValue:s.rubroProductoSeleccionado,"onUpdate:modelValue":o[17]||(o[17]=i=>s.rubroProductoSeleccionado=i),disabled:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),r(l,{span:2},{default:t(()=>[Po,r(g,{modelValue:s.unidadProductoSeleccionado,"onUpdate:modelValue":o[18]||(o[18]=i=>s.unidadProductoSeleccionado=i),disabled:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),r(l,{span:4},{default:t(()=>[yo,D(r(Y,{modelValue:s.cantidadAComprarProductoSeleccionado,"onUpdate:modelValue":o[19]||(o[19]=i=>s.cantidadAComprarProductoSeleccionado=i),controls:!1,style:{width:"100%"}},null,8,["modelValue"]),[[U,s.loadingCantidadAComprar]])]),_:1}),r(l,{span:2},{default:t(()=>[Co,r(R,{type:"primary",style:{width:"100%"},onClick:o[20]||(o[20]=i=>h.agregarProductoAComprar())},{default:t(()=>[Do]),_:1})]),_:1})]),_:1}),r(H,{data:s.arrayProductosAComprar,stripe:"",style:{width:"100%"},gutter:"5"},{default:t(()=>[r(V,{prop:"nombre",label:"Nombre"},{default:t(i=>[d("span",null,p(i.row.producto_nombre),1)]),_:1}),r(V,{prop:"codigo",label:"C\xF3digo",width:"120px"},{default:t(i=>[d("span",null,p(i.row.producto_codigo),1)]),_:1}),r(V,{prop:"unidad",label:"Unidad",width:"120px"},{default:t(i=>[d("span",null,p(i.row.producto_unidad),1)]),_:1}),r(V,{prop:"rubro",label:"Rubro",width:"120px"},{default:t(i=>[d("span",null,p(i.row.rubro_nombre),1)]),_:1}),r(V,{prop:"cantidad",label:"Cant. a comp.",width:"120px"},{default:t(i=>[d("span",null,p(i.row.cantidadAComprar),1)]),_:1}),r(V,{prop:"cantidadDeposito",label:"Cant. dep\xF3sito",width:"120px"},{default:t(i=>[d("span",null,p(parseFloat(i.row.cantidadDeposito)),1)]),_:1}),r(V,{prop:"cantidadDeposito",label:"",width:"70"},{default:t(i=>[r(R,{type:"primary",style:{width:"10%","margin-bottom":"3px","margin-left":"3px"},onClick:w=>e.$refs.modalBuscarProductoDeposito.abrir(i,s.arrayCantidadesDeposito)},{default:t(()=>[So]),_:2},1032,["onClick"])]),_:1}),r(V,{prop:"cantidadReal",label:"Cant. real a comprar",width:"120px"},{default:t(i=>[r(Y,{modelValue:i.row.cantidadRealAComprar,"onUpdate:modelValue":w=>i.row.cantidadRealAComprar=w,max:i.row.cantidadAComprar,controls:!1,align:"center","text-align":"center",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),r(V,{prop:"cantidadReal",label:"Observaciones",width:"120px"},{default:t(i=>[r(g,{modelValue:i.row.observaciones,"onUpdate:modelValue":w=>i.row.observaciones=w,align:"center","text-align":"center",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(V,{label:"Eliminar",width:"120",align:"center","text-align":"center"},{default:t(i=>[r(R,{type:"danger",circle:"",onClick:w=>h.eliminarItemArrayProductosAComprar(i)},{default:t(()=>[Ao]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),d("div",Eo,[r(R,{type:"info",class:"btnAtras",onClick:o[21]||(o[21]=i=>s.active=0)},{default:t(()=>[Ro]),_:1}),r(R,{type:"primary",class:"btnSiguiente",onClick:o[22]||(o[22]=i=>h.activar2yTraerProveedoresxRubro())},{default:t(()=>[wo]),_:1})])],512),[[B,s.active==1]]),D((u(),f("div",xo,[(u(!0),f(x,null,M(s.arrayRubrosAComprar,(i,w)=>(u(),f("div",{key:w},[r(I,{modelValue:i.rubro_elegido,"onUpdate:modelValue":y=>i.rubro_elegido=y,onChange:y=>h.cambiarSeleccionSubItemsRubroElegido(i)},{default:t(()=>[d("h3",null,[d("b",null,p(i.rubro_nombre),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),(u(!0),f(x,null,M(s.arrayProveedoresMostrar,(y,T)=>(u(),f("div",{key:T},[y.rubro.rubro_id==i.rubro_id?(u(),f("div",Vo,[r(I,{modelValue:y.proveedor_elegido,"onUpdate:modelValue":q=>y.proveedor_elegido=q,size:"large",border:""},{default:t(()=>[m(p(y.proveedor.proveedor_nombre)+" - "+p(y.proveedor.proveedor_email),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])])):k("",!0)]))),128))]))),128)),d("div",Mo,[r(R,{type:"info",class:"btnAtras",onClick:o[23]||(o[23]=i=>s.active=1)},{default:t(()=>[ko]),_:1}),r(R,{type:"primary",class:"btnSiguiente",onClick:o[24]||(o[24]=i=>s.active=3)},{default:t(()=>[Fo]),_:1})])])),[[B,s.active==2],[U,s.loadingProveedoresParaMail]]),D(d("div",Oo,[No,m(" "+p(s.arrayCantidadesDeposito)+" ",1),r(E,{style:{"margin-top":"10px"}},{default:t(()=>[r(l,{span:12},{default:t(()=>[d("div",Uo,[To,r(_,{modelValue:s.fechaLimiteCarga,"onUpdate:modelValue":o[25]||(o[25]=i=>s.fechaLimiteCarga=i),type:"date",placeholder:"Ingrese la fecha l\xEDmite",size:e.size},null,8,["modelValue","size"])])]),_:1})]),_:1}),r(E,{gutter:10,style:{"margin-top":"10px"}},{default:t(()=>[r(l,{span:12},{default:t(()=>[Bo,(u(!0),f(x,null,M(s.arrayRubrosAComprar,(i,w)=>(u(),f("div",{key:w},[d("h4",zo,[d("b",null,p(i.rubro_nombre),1)]),(u(!0),f(x,null,M(s.arrayProductosAComprar,(y,T)=>(u(),f("div",{key:T},[d("ul",null,[y.rubro_id==i.rubro_id?(u(),f("div",Go,[d("li",null,[r(E,null,{default:t(()=>[r(l,{span:18},{default:t(()=>[m(p(y.producto_nombre),1)]),_:2},1024),r(l,{span:4},{default:t(()=>[m(p(y.cantidadRealAComprar),1)]),_:2},1024)]),_:2},1024)])])):k("",!0)])]))),128))]))),128))]),_:1}),r(l,{span:12},{default:t(()=>[Yo,(u(!0),f(x,null,M(s.arrayRubrosAComprar,(i,w)=>(u(),f("div",{key:w},[d("h4",Io,[d("b",null,p(i.rubro_nombre),1)]),(u(!0),f(x,null,M(s.arrayProveedoresMostrar,(y,T)=>(u(),f("div",{key:T},[d("ul",null,[y.rubro.rubro_id==i.rubro_id?(u(),f("div",Ho,[y.proveedor_elegido==!0?(u(),f("div",Jo,[d("li",null,[r(E,null,{default:t(()=>[r(l,{span:12},{default:t(()=>[m(p(y.proveedor.proveedor_nombre),1)]),_:2},1024),r(l,{span:12},{default:t(()=>[m(p(y.proveedor.proveedor_email),1)]),_:2},1024)]),_:2},1024)])])):k("",!0)])):k("",!0)])]))),128))]))),128))]),_:1})]),_:1}),d("div",Lo,[r(R,{type:"info",class:"btnAtras",onClick:o[26]||(o[26]=i=>s.active=2)},{default:t(()=>[jo]),_:1}),r(J,{class:"btnSiguiente"},{default:t(()=>[r(R,{type:"primary",onClick:h.onSubmitBorrador,loading:s.loadingOnSubmitBorrador},{default:t(()=>[qo]),_:1},8,["onClick","loading"]),r(R,{type:"success",onClick:h.onSubmit,loading:s.loadingOnSubmit},{default:t(()=>[Ko]),_:1},8,["onClick","loading"])]),_:1})])],512),[[B,s.active==3]])]),_:1},8,["impedir-close"])]),r(j,{ref:"modalBuscarProductoDeposito","onUpdate:cantidadSacarDeposito":o[27]||(o[27]=i=>h.cantidadSacadaDeposito(i))},null,512)],64)}var Wo=z(lo,[["render",Qo],["__scopeId","data-v-cc19706e"]]);const Xo={components:{ModalDetalle:ao,ModalEditar:Wo},data(){return{loading:!1,borradorpresupuestaciones:[],loading:!1}},mounted(){this.obtenerTodos(),this.obtenerTodosArticulo()},methods:{async obtenerTodos(){this.loading=!0,await this.axios.get("/api/borradorpresupuestacion/obtenerTodos").then(e=>{console.log(e.data),this.borradorpresupuestaciones=e.data,console.log("this.borradorpresupuestaciones"),console.log(this.borradorpresupuestaciones)}),this.loading=!1},async obtenerTodosArticulo(){this.loading=!0,await this.axios.get(this.base_url+"/articulo/obtenerTodos").then(e=>{this.articulos=e.data}),this.loading=!1},formatearFecha(e){return new Date(e).toLocaleDateString()},formatearFechaSinDia(e){let o=new Date(e);return o.getMonth()+1+""+o.getFullYear(),o}}},Zo=d("h1",null,"Borradores",-1),$o={class:"contenedor-tabla",style:{"margin-top":"15px"}},or={key:0},rr=m("Borrador"),er={key:1},ar=m("Presupuestado"),tr=d("span",{class:"material-icons"},"edit",-1),sr=d("span",{class:"material-icons"},"visibility",-1);function ir(e,o,a,n,s,h){const b=c("el-table-column"),S=c("el-tag"),P=c("el-button"),v=c("el-table"),A=c("el-card"),g=c("modal-editar"),l=c("modal-detalle"),E=G("loading");return u(),f(x,null,[d("main",null,[r(A,null,{header:t(()=>[Zo]),default:t(()=>[d("div",$o,[D((u(),O(v,{data:s.borradorpresupuestaciones,stripe:"",style:{width:"100%"}},{default:t(()=>[r(b,{prop:"presupuestacion_id",label:"Nro."},{default:t(_=>[m(p(_.row.borrador_presupuestacion_id),1)]),_:1}),r(b,{prop:"presupuestacion_plan_nombre",label:"Fecha de creaci\xF3n"},{default:t(_=>[m(p(h.formatearFecha(_.row.borrador_presupuestacion_fecha_creacion)),1)]),_:1}),r(b,{prop:"presupuestacion_plan_nombre",label:"Plan"},{default:t(_=>[m(p(_.row.borrador_presupuestacion_plan_nombre),1)]),_:1}),r(b,{prop:"presupuestacion_plan_nombre",label:"Fecha de incio"},{default:t(_=>[m(p(h.formatearFecha(_.row.borrador_presupuestacion_fecha_incio)),1)]),_:1}),r(b,{prop:"presupuestacion_plan_nombre",label:"Fecha de fin"},{default:t(_=>[m(p(h.formatearFecha(_.row.borrador_presupuestacion_fecha_fin)),1)]),_:1}),r(b,{prop:"borrador_presupuestado",label:"Estado"},{default:t(_=>[_.row.borrador_presupuestado==0?(u(),f("span",or,[r(S,{class:"ml-2",type:"warning"},{default:t(()=>[rr]),_:1})])):k("",!0),_.row.borrador_presupuestado==1?(u(),f("span",er,[r(S,{class:"ml-2",type:"success"},{default:t(()=>[ar]),_:1})])):k("",!0)]),_:1}),r(b,{label:"Editar",prop:"editar","header-align":"right",align:"right",width:"90px"},{default:t(_=>[r(P,{type:"primary",circle:"",onClick:N=>e.$refs.modalEditar.abrir(_.row.borrador_presupuestacion_id),disabled:_.row.borrador_presupuestado==1},{default:t(()=>[tr]),_:2},1032,["onClick","disabled"])]),_:1}),r(b,{label:"Detalle",prop:"detalle","header-align":"right",align:"right",width:"90px"},{default:t(_=>[r(P,{type:"primary",circle:"",onClick:N=>e.$refs.modalDetalle.abrir(_.row.borrador_presupuestacion_id)},{default:t(()=>[sr]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[E,s.loading]])])]),_:1})]),r(g,{ref:"modalEditar",onActualizarTabla:h.obtenerTodos},null,8,["onActualizarTabla"]),r(l,{ref:"modalDetalle"},null,512)],64)}var nr=z(Xo,[["render",ir]]);export{nr as default};
